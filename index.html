<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Importer Monochrome</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --panel:#ffffff;
  --ink:#0b0b0b;
  --muted:#6b6b6b;
  --glass: rgba(11,11,11,0.06);
  --accent:#000000;
  --shadow: 0 6px 20px rgba(11,11,11,0.06);
}

*{ box-sizing:border-box }

html,body{
  height:100%;
  margin:0;
  font-family:Inter,system-ui;
  color:var(--ink);
  background:transparent;
}

/* background canvas */
#bg {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
}

/* UI above canvas */
body > *:not(canvas) {
  position: relative;
  z-index: 2;
}

.container{
  max-width:1100px;
  margin:0 auto;
  padding:28px;
  display:grid;
  grid-template-columns: 420px 1fr;
  gap:28px;
  align-items:start;
}

.card{
  background:var(--panel);
  border-radius:6px;
  box-shadow:var(--shadow);
  padding:20px;
  border:1px solid var(--glass);
}

h1{ margin:0 0 8px 0;font-size:20px;font-weight:700 }
p.lead{ margin:0 0 18px;color:var(--muted);font-size:13px }

.file-row{ display:flex;gap:10px;align-items:center }
input[type=file]{ display:block }

.btn{
  background:var(--accent);
  color:#fff;
  padding:10px 14px;
  border:none;
  border-radius:4px;
  cursor:pointer;
  font-size:13px;
  font-weight:600;
}

.btn.ghost{
  background:transparent;
  color:var(--ink);
  border:1px solid var(--glass);
}

.btn:hover{
  background:#f5f5f5;
  color:#0b0b0b;
  border:1px solid #0b0b0b;
}

.about-btn{
  background:white;
  color:black;
  padding:8px 12px;
  border-radius:6px;
  margin-left:90%;
  display:block;
  margin-top:20px;
  font-size:12px;
  height: 50px;
}

.about-btn:hover{
  background:black;
  color: #eee;
}

.progress{
  margin-top:12px;
  height:12px;
  background:#f2f2f2;
  border-radius:8px;
  overflow:hidden;
}
.progress > i{
  height:100%;
  width:0%;
  background:var(--accent);
  transition:width 260ms linear;
}

.meta{ font-size:12px;color:var(--muted);margin-top:8px }

.grid{
  display:grid;
  grid-template-rows:auto auto;
  gap:18px;
}

.row{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}

thead th{
  padding:10px 12px;
  color:var(--muted);
  font-weight:600;
  border-bottom:1px solid #eee;
}
tbody td{
  padding:10px 12px;
  border-bottom:1px solid #f5f5f5;
}

.status-pill{
  padding:6px 10px;
  border-radius:999px;
  background:#f5f5f5;
  color:var(--muted);
  font-size:12px;
  font-weight:600;
}

footer{
  text-align:center;
  margin-top:30px;
  color:var(--muted);
  font-size:12px;
}

/* modal */
#aboutModal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.4);
  display:none;
  justify-content:center;
  align-items:center;
  backdrop-filter:blur(4px);
  z-index:999;
}

.modal-card{
  background:#fff;
  width:300px;
  border-radius:12px;
  padding:22px;
  box-shadow:0 10px 30px rgba(0,0,0,0.1);
  animation:fadeIn .25s ease;
}

.modal-card h2{
  margin:0 0 10px;
  font-size:18px;
}

.modal-card p{
  margin:4px 0;
  font-size:14px;
}

.close-modal{
  margin-top:14px;
  padding:6px 12px;
  background:#fff;
  border:1px solid #ddd;
  border-radius:8px;
  cursor:pointer;
}

@keyframes fadeIn{
  from{ opacity:0; transform:translateY(6px) }
  to{ opacity:1; transform:translateY(0) }
}
</style>
</head>


<body>
<div id="bg"></div>

<button class="btn about-btn" id="aboutBtn">About me</button>

<div class="container">

  <aside class="card">
    <h1>CSV Importer</h1>
    <p class="lead">Upload SKU CSV and view progress visually.</p>

    <div>
      <label style="font-size:12px;color:var(--muted)">Select CSV</label>
      <div class="file-row">
        <input id="file" type="file" accept=".csv">
        <button id="uploadBtn" class="btn">Upload</button>
      </div>

      <div class="progress"><i id="bar"></i></div>
      <div class="meta" id="meta">No job started</div>

      <div style="margin-top:14px;display:flex;gap:8px">
        <button id="refreshBtn" class="btn ghost">Refresh</button>
        <button class="btn ghost" onclick="window.open('/docs','_blank')">Open API</button>
      </div>
    </div>

    <hr style="margin:18px 0;border:0;border-top:1px solid #eee">

    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div style="font-weight:700">Progress</div>
        <div style="font-size:12px;color:var(--muted)">Simulated worker</div>
      </div>
      <div id="statusPill" class="status-pill">Idle</div>
    </div>
  </aside>

  <main class="grid">
    <section class="card">
      <div class="row">
        <div>
          <div style="font-weight:700">Products</div>
          <div style="font-size:12px;color:var(--muted)">Loaded from backend</div>
        </div>
        <button class="btn" onclick="createSample()">Quick add</button>
      </div>

      <div style="overflow:auto;max-height:480px">
        <table>
          <thead>
            <tr>
              <th>SKU</th><th>Name</th><th>Price</th><th>Stock</th>
            </tr>
          </thead>
          <tbody id="plist"></tbody>
        </table>
      </div>
    </section>

    <section class="card">
      <div>
        <div style="font-weight:700">Webhook</div>
        <div style="font-size:12px;color:var(--muted)">Register and test</div>
      </div>

      <div style="margin-top:12px;display:flex;gap:8px">
        <input id="hookUrl" type="url" placeholder="https://example.com/hook"
               style="flex:1;padding:10px;border-radius:8px;border:1px solid #eee">
        <button id="regBtn" class="btn ghost">Register</button>
        <button id="testBtn" class="btn">Test</button>
      </div>

      <div id="hookRes" style="margin-top:12px;font-size:13px;color:var(--muted)"></div>
    </section>

  </main>

</div>

<footer style="color: #eee;">Scoped demo using FastAPI backend</footer>

<!-- Modal -->
<div id="aboutModal">
  <div class="modal-card">
    <h2>Author</h2>
    <p><strong>Name:</strong> Velan</p>
    <p><strong>Email:</strong> velane929@gmail.com</p>
    <p><strong>LinkedIn:</strong> <a href="https://linkedin.com/in/velan-e" target="_blank">linkedin.com/in/velan-e</a></p>
    <p><strong>GitHub:</strong> <a href="https://github.com/chilly23" target="_blank">github.com/chilly23</a></p>
    <button id="closeAbout" class="close-modal">Close</button>
  </div>
</div>

<script>
const apiBase = "https://screening-task-sde-1-fulfil-7.onrender.com";

const uploadBtn = document.getElementById("uploadBtn");
const fileInput = document.getElementById("file");
const bar = document.getElementById("bar");
const meta = document.getElementById("meta");
const plist = document.getElementById("plist");
const statusPill = document.getElementById("statusPill");

let jobId = null;

async function loadProducts(){
  try{
    const res = await fetch(apiBase + "/products");
    const data = await res.json();
    plist.innerHTML = data.length
      ? data.map(p => `<tr><td>${p.sku}</td><td>${p.name}</td><td>${p.price}</td><td>${p.stock}</td></tr>`).join("")
      : `<tr><td colspan="4" style="padding:14px;color:#999">No products</td></tr>`;
  }catch{
    plist.innerHTML = `<tr><td colspan="4" style="padding:14px;color:#999">Backend unreachable</td></tr>`;
  }
}

uploadBtn.onclick = async () => {
  if(!fileInput.files.length) return alert("Choose a CSV");

  const fd = new FormData();
  fd.append("file", fileInput.files[0]);

  statusPill.innerText = "Starting";

  const res = await fetch(apiBase + "/upload-csv", { method:"POST", body:fd });
  const j = await res.json();

  jobId = j.job_id;
  meta.innerText = "Job " + jobId;

  pollProgress();
};

async function pollProgress(){
  if(!jobId) return;

  try{
    const r = await fetch(apiBase + "/progress/" + jobId);
    const j = await r.json();
    const pct = j.progress || 0;

    bar.style.width = pct + "%";
    statusPill.innerText = "Running";
    meta.innerText = "Job " + jobId + " " + pct + "%";

    if(pct < 100) setTimeout(pollProgress, 500);
    else{
      statusPill.innerText = "Done";
      loadProducts();
    }
  }catch{
    statusPill.innerText = "Error";
  }
}

document.getElementById("refreshBtn").onclick = loadProducts;

document.getElementById("regBtn").onclick = async () => {
  const url = hookUrl.value.trim();
  if(!url) return alert("Enter URL");
  const r = await fetch(apiBase + "/webhook/register?url=" + encodeURIComponent(url), { method:"POST" });
  hookRes.innerText = JSON.stringify(await r.json());
};

document.getElementById("testBtn").onclick = async () => {
  const url = hookUrl.value.trim();
  if(!url) return alert("Enter URL");
  const r = await fetch(apiBase + "/webhook/test?url=" + encodeURIComponent(url), { method:"POST" });
  hookRes.innerText = JSON.stringify(await r.json());
};

loadProducts();

/* modal */
aboutBtn.onclick = () => aboutModal.style.display = "flex";
closeAbout.onclick = () => aboutModal.style.display = "none";
aboutModal.onclick = e => { if(e.target === aboutModal) aboutModal.style.display = "none" };
</script>

<!-- working CDN versions -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.fog.min.js"></script>

<script>
VANTA.FOG({
  el: "#bg",
  mouseControls: true,
  touchControls: true,
  gyroControls: true,
  minHeight: 200,
  minWidth: 200,
  highlightColor: 0xff00d8
});
</script>

</body>
</html>
